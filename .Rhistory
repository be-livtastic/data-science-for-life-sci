download(url, destfile = filename)
filename <- "femaleMiceWeights.csv"
# ---- Download female mice weights dataset ----
url <- "https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/femaleMiceWeights.csv"
filename <- "femaleMiceWeights.csv"
download(url, destfile = filename)
# Read the data into R
dat <- read.csv(filename)
View(dat)
# Filter data to include only chow diet mice
controls <- filter(dat, Diet == "chow")
View(controls)
# Extract the Bodyweight column (as a data frame)
select(controls, Bodyweight)
# Convert Bodyweight column to a numeric vector
unlist(select(controls, Bodyweight))
treatment <- filter(dat, Diet == "hf") %>% select(Bodyweight) %>% unlist()
treatment
mean(treatment)
mean(controls)
# Same operation as above, written as a single pipeline
controls <- filter(dat, Diet == "chow") %>%
select(Bodyweight) %>%
unlist()
# Same operation as above, written as a single pipeline
controls <- filter(dat, Diet == "chow") %>%
select(Bodyweight) %>%
unlist()
mean(controls)
# Random Variables and Statistical Inference
mean(controls)
mean(treatment)
# Calculate the difference in means between treatment and control groups
diff_in_means <- mean(treatment) - mean(controls)
diff_in_means
population<- read.csv("femaleControlsPopulation.csv")
head(population)
poplation_weights <- unlist(population)
mean(sample(poplation_weights, 12))
# Testing null hypothesis by simulating random assignment of mice to treatment and control groups
control_sample <- sample(poplation_weights, 12)
treatment_sample <- sample(poplation_weights, 12)
mean(treatment_sample) - mean(control_sample)
# Repeat the random assignment process many times to build a null distribution
n<- 10000
nulls<-replicate(n, {
control_sample <- sample(poplation_weights, 12)
treatment_sample <- sample(poplation_weights, 12)
mean(treatment_sample) - mean(control_sample)
})
max(nulls)
min(nulls)
head(nulls)
abline(v=diff_in_means, col="red", lwd=2)
# Visualize the null distribution
hist(nulls, main="Null Distribution of Mean Differences", xlab="Mean Difference (Treatment - Control)")
abline(v=diff_in_means, col="red", lwd=2)
# Calculate the p-value
p_value <- mean(abs(nulls) >= abs(diff_in_means))
p_value
p_value < 0.05
install.packages("gapminder")
library(gapminder)
data("gapminder")
View(dat)
data(gapminder)
head(gapminder)
prop = function(q) {
mean(x <= 40)
}
qs = seq(from=min(x), to=max(x), length=20)
View(prop)
prop = function(q) {
mean(x <= 40)
}
mean(x <= q)
mean(x <= 40)
View(gapminder)
mean("lifeExp" <= 40)
prop = function(q) {
mean("lifeExp" <= 40)
}qs = seq(from=min(x), to=max(x), length=20)
q()
# Install and load required packages mentioned in course book
install.packages("rafalib")
library(rafalib)
install.packages("Rtools")     # Needed for building some R packages
install.packages("devtools")   # Development tools
install.packages("downloader") # For downloading files from URLs
library(downloader)
install.packages("dplyr")
library(dplyr)
# ---- Download female mice weights dataset ----
url <- "https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/femaleMiceWeights.csv"
filename <- "femaleMiceWeights.csv"
download(url, destfile = filename)
# Read the data into R
dat <- read.csv(filename)
# Filter data to include only chow diet mice
controls <- filter(dat, Diet == "chow")
# Extract the Bodyweight column (as a data frame)
select(controls, Bodyweight)
# Convert Bodyweight column to a numeric vector
unlist(select(controls, Bodyweight))
# Same operation as above, written as a single pipeline
controls <- filter(dat, Diet == "chow") %>%
select(Bodyweight) %>%
unlist()
# Extract Bodyweight for Treatment group using a single pipeline
treatment <- filter(dat, Diet == "hf") %>% select(Bodyweight) %>% unlist()
# Random Variables and Statistical Inference
mean(controls)
mean(treatment)
# Calculate the difference in means between treatment and control groups
diff_in_means <- mean(treatment) - mean(controls)
diff_in_means
# ---- Sampling from the Mice Population to see the mean is the same as to the controls/treatment groups----
population<- read.csv("femaleControlsPopulation.csv")
head(population)
poplation_weights <- unlist(population)
mean(sample(poplation_weights, 12)) # Repeat the sampling process multiple times to see the variability in sample means
# Testing null hypothesis by simulating random assignment of mice to treatment and control groups
control_sample <- sample(poplation_weights, 12)
treatment_sample <- sample(poplation_weights, 12)
mean(treatment_sample) - mean(control_sample)
# Repeat the random assignment process many times to build a null distribution
n<- 10000
nulls<-replicate(n, {
control_sample <- sample(poplation_weights, 12)
treatment_sample <- sample(poplation_weights, 12)
mean(treatment_sample) - mean(control_sample)
})
# Visualize the null distribution
hist(nulls, main="Null Distribution of Mean Differences", xlab="Mean Difference (Treatment - Control)")
abline(v=diff_in_means, col="red", lwd=2)
# Calculate the p-value
p_value <- mean(abs(nulls) >= abs(diff_in_means))
p_value
p_value < 0.05
?set.seed
# For-loop to take samples
for (i in 1:n) {
sample_5 <- sample(population_weights, size = 5)
avg_5[i] <- mean(sample_5)
}
# For-loop to take samples
for (i in 1:n) {
sample_5 <- sample(poplation_weights, size = 5)
avg_5[i] <- mean(sample_5)
}
avg_5 <- numeric(n)  # Pre-allocate a vector to store sample means
avg_5[i] <- mean(sample_5)
avg_5
#It can be saved and restored, but should not be altered by the user.
set.seed(1) # Set seed for reproducibility
avg_5 <- numeric(n)  # Pre-allocate a vector to store sample means
# For-loop to take samples
for (i in 1:n) {
sample_5 <- sample(poplation_weights, size = 5)
avg_5[i] <- mean(sample_5)
}
avg_5
# sample size of 50
set.seed(1)
avg_50 <- numeric(n)
for (i in 1:n) {
sample_50 <- sample(poplation_weights, size = 50)
avg_50[i] <- mean(sample_50)
}
avg_50
# Visualize the distributions of sample means for size 5 and size 50
par(mfrow=c(1,2))  # Set up the plotting area to have 1 row and 2 columns
hist(avg_5, main="Sample Size = 5", xlab="Sample Means", col="lightblue", border="black")
hist(avg_50, main="Sample Size = 50", xlab="Sample Means", col="lightgreen", border="black")
par(mfrow=c(1,1))  # Reset plotting area to default
View(dat)
datPheno <- na.omit(micePheno) # Remove rows with missing values)
datPheno <- read.csv("mice_pheno.csv") # Load the mice phenotype dataset
datPheno <- na.omit(micePheno) # Remove rows with missing values)
datPheno <- na.omit(datPheno) # Remove rows with missing values)
View(datPheno)
View(datPheno)
head(datPheno)
controlPheno <- filter( datPheno, Sex == "F" & Diet == "chow") |
select( Bodyweight) | unlist()
controlPheno <- filter( datPheno, Sex == "F" & Diet == "chow") %>%
select( Bodyweight) %>% unlist()
hfPheno <- filter( datPheno, Sex == "F" & Diet == "hf") %>%
select( Bodyweight) %.% unlist()
hfPheno <- filter( datPheno, Sex == "F" & Diet == "hf") %>%
select( Bodyweight) %>% unlist()
par(mfrow=c(1,2))
hist(controlPheno, main="Control Group Bodyweights", xlab="Bodyweight", col="lightblue", border="black")
hist(hfPheno, main="High Fat Diet Group Bodyweights", xlab="Bodyweight", col="lightgreen", border="black")
# qq-plots to confirm distribution are relatively close to being normal
#If the points fall on the identity line, then the data is close to the theoretical distribution.
par(mfrow=c(1,2))
qqnorm(controlPheno, main="QQ-Plot: Control Group")
qqline(controlPheno, col="red")
qqnorm(hfPheno, main="QQ-Plot: High Fat Diet Group")
qqline(hfPheno, col="red")
par(mfrow=c(1,1))
# ---- Using t-test to compare means of two groups ----
t_test <- diff_in_means / sd(nulls)
t_test
# ---- Using t-test to compare means of two groups ----
t_sim <- diff_in_means / sd(nulls)
t_sim
# Manual calculation of t-statistic
n_control <- length(controls)
n_treat <- length(treatment)
# Calculate pooled standard deviation
se_pooled <- sqrt(
var(controls)/n_control + var(treatment)/n_treat
)
t_actual <- diff_in_means / se_pooled
t_actual
# Using built-in t.test function
t_test_result <- t.test(treatment, controls)
t_test_result$statistic  # t-statistic
t_test_result$p.value    # p-value
# ---- More Practice with CLT and t-tests ----
mu_hf <- mean(hfPheno)
mu_control <- mean(controlPheno)
diff_means_pheno <- mu_hf - mu_control
diff_means_pheno
# Install and load required packages mentioned in course book
install.packages("rafalib")
library(rafalib)
install.packages("Rtools")     # Needed for building some R packages
install.packages("devtools")   # Development tools
install.packages("downloader") # For downloading files from URLs
library(downloader)
install.packages("dplyr")
library(dplyr)
# ---- Download female mice weights dataset ----
url <- "https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/femaleMiceWeights.csv"
filename <- "femaleMiceWeights.csv"
download(url, destfile = filename)
# Read the data into R
dat <- read.csv(filename)
# Filter data to include only chow diet mice
controls <- filter(dat, Diet == "chow")
# Extract the Bodyweight column (as a data frame)
select(controls, Bodyweight)
# Convert Bodyweight column to a numeric vector
unlist(select(controls, Bodyweight))
# Same operation as above, written as a single pipeline
controls <- filter(dat, Diet == "chow") %>%
select(Bodyweight) %>%
unlist()
# Extract Bodyweight for Treatment group using a single pipeline
treatment <- filter(dat, Diet == "hf") %>% select(Bodyweight) %>% unlist()
# Random Variables and Statistical Inference
mean(controls)
mean(treatment)
# Calculate the difference in means between treatment and control groups
diff_in_means <- mean(treatment) - mean(controls)
diff_in_means
# ---- Sampling from the Mice Population to see the mean is the same as to the controls/treatment groups----
population<- read.csv("femaleControlsPopulation.csv")
head(population)
poplation_weights <- unlist(population)
mean(sample(poplation_weights, 12)) # Repeat the sampling process multiple times to see the variability in sample means
# Testing null hypothesis by simulating random assignment of mice to treatment and control groups
control_sample <- sample(poplation_weights, 12)
treatment_sample <- sample(poplation_weights, 12)
mean(treatment_sample) - mean(control_sample)
# Repeat the random assignment process many times to build a null distribution
n<- 10000
nulls<-replicate(n, {
control_sample <- sample(poplation_weights, 12)
treatment_sample <- sample(poplation_weights, 12)
mean(treatment_sample) - mean(control_sample)
})
# Visualize the null distribution
hist(nulls, main="Null Distribution of Mean Differences", xlab="Mean Difference (Treatment - Control)")
abline(v=diff_in_means, col="red", lwd=2)
# Calculate the p-value
p_value <- mean(abs(nulls) >= abs(diff_in_means))
p_value
p_value < 0.05
# --- Normal Distribution and Central Limit Theorem ----
?set.seed #.Random.seed is an integer vector, containing the random number generator (RNG) state for random number generation in R.
set.seed(1) # Set seed for reproducibility
# sample size of 5
avg_5 <- numeric(n)  # Pre-allocate a vector to store sample means
# For-loop to take samples
for (i in 1:n) {
sample_5 <- sample(poplation_weights, size = 5)
avg_5[i] <- mean(sample_5)
}
avg_5
# sample size of 50
set.seed(1)
avg_50 <- numeric(n)
for (i in 1:n) {
sample_50 <- sample(poplation_weights, size = 50)
avg_50[i] <- mean(sample_50)
}
avg_50
# Visualizing the normal distributions of sample means for size 5 and size 50
par(mfrow=c(1,2))  # Set up the plotting area to have 1 row and 2 columns
hist(avg_5, main="Sample Size = 5", xlab="Sample Means", col="lightblue", border="black")
hist(avg_50, main="Sample Size = 50", xlab="Sample Means", col="lightgreen", border="black")
par(mfrow=c(1,1))  # Reset plotting area to default
# ---- Assessing Normality of Mice Weights ----
datPheno <- read.csv("mice_pheno.csv") # Load the mice phenotype dataset
datPheno <- na.omit(datPheno) # Remove rows with missing values)
head(datPheno)
controlPheno <- filter( datPheno, Sex == "F" & Diet == "chow") %>%
select( Bodyweight) %>% unlist()
hfPheno <- filter( datPheno, Sex == "F" & Diet == "hf") %>%
select( Bodyweight) %>% unlist()
par(mfrow=c(1,2))
hist(controlPheno, main="Control Group Bodyweights", xlab="Bodyweight", col="lightblue", border="black")
hist(hfPheno, main="High Fat Diet Group Bodyweights", xlab="Bodyweight", col="lightgreen", border="black")
par(mfrow=c(1,1))
# qq-plots to confirm distribution are relatively close to being normal
#If the points fall on the identity line, then the data is close to the theoretical distribution.
par(mfrow=c(1,2))
qqnorm(controlPheno, main="QQ-Plot: Control Group")
qqline(controlPheno, col="red")
qqnorm(hfPheno, main="QQ-Plot: High Fat Diet Group")
qqline(hfPheno, col="red")
par(mfrow=c(1,1))
# ---- Using t-test to compare means of two groups ----
t_sim <- diff_in_means / sd(nulls)
t_sim
# Manual calculation of t-statistic
n_control <- length(controls)
n_treat <- length(treatment)
# Calculate pooled standard deviation
se_pooled <- sqrt(
var(controls)/n_control + var(treatment)/n_treat
)
t_actual <- diff_in_means / se_pooled
t_actual
# Using built-in t.test function
t_test_result <- t.test(treatment, controls)
t_test_result$statistic  # t-statistic
t_test_result$p.value    # p-value
# Conclusion: Both manual calculation and t.test function yield similar t-statistics and p-values, confirming the significant effect of diet on mice weights.
t_test_result
# ---- Confidence Intervals ----
# 95% Confidence Interval using t.test
t_test_result$conf.int
# ---- Confidence Intervals ----
# 95% Confidence Interval using t.test
t_test_result
t_test_result$conf.int
url <- "https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/babies.txt"
filename <- basename(url)
download(url, destfile=filename)
babies <- read.table("babies.txt", header=TRUE)
head(babies)
# Extract birth weights for non-smoking and smoking mothers
bwt.nonsmoke <- filter(babies, smoke==0) %>% select(bwt) %>% unlist
bwt.smoke <- filter(babies, smoke==1) %>% select(bwt) %>% unlist
mean(bwt.nonsmoke) - mean(bwt.smoke)
popsd(bwt.nonsmoke)
popsd(bwt.smoke)
t.test(bwt.nonsmoke, bwt.smoke)
View(dat)
View(datPheno)
View(population)
chowPopulation <- dat[dat$Sex == "F" & dat$Diet == "chow", 3]
dat<- read.csv("mice_pheno.csv")
chowPopulation <- dat[dat$Sex == "F" & dat$Diet == "chow", 3]
head(chowPopulation)
mu_chow <- mean(chowPopulation, na.rm=TRUE)
print(mu_chow)
chowSample <- sample(chowPopulation, N)
set.seed(1)
N<- 30
chowSample <- sample(chowPopulation, N)
mean_chowSample <- mean(chowSample)
print(mean_chowSample)
N<- 30
chowSample <- sample(chowPopulation, N)
mean_chowSample <- mean(chowSample)
print(mean_chowSample)
se_chowSample <- sd(chowSample)/sqrt(N)
print(se_chowSample)
Q <- qnorm(1 - 0.05/2)
interval <- c(mean_chowSample - Q * se_chowSample, mean_chowSample + Q * se_chowSample)
print(interval)
interval[1] < mu_chow & interval[2] > mu_chow
print(chowSample)
B <- 250
mypar()
B <- 250
mypar()
plot(mean(chowPopulation)+c(-7,7), c(1,1), type="n", xlab="Bodyweight", ylab="interval", ylim = c(1,B))
abline(v=mean(chowPopulation), col="red", lwd=2) # True mean line
set.seed(1)
for(b in 1:B){
chow <- sample(chowPopulation, N)
se_chow <- sd(chow)/sqrt(N)
interval <- c(mean(chow) - Q * se_chow, mean(chow) + Q * se_chow)
covered <-
mean(chowPopulation) <= interval[2] & mean(chowPopulation) >= interval[1]
color <- ifelse(covered, "black", "red")
segments(interval[1], b, interval[2], b, col=color)
lines(interval, c(b,b), col=color, lwd=2)
}
set.seed(1)
N <- 5
hf <- sample(hfPopulation,N)
hf <- sample(hfPheno,N)
control <- sample(controlPheno,N)
t.test(hf,control)$p.value
set.seed(1)
alpha <- 0.05
N <- 12
B <- 2000
hf <- sample(hfPheno,N)
control <- sample(controlPheno,N)
t.test(hf,control)$p.value
reject <- function(N, alpha){
hf <- sample(hfPheno,N)
control <- sample(controlPheno,N)
pval <- t.test(hf,control)$p.value
return(pval < alpha)
}
reject (12)
alpha <- 0.05
N <- 12
B <- 2000
reject <- function(N, alpha){
hf <- sample(hfPheno,N)
control <- sample(controlPheno,N)
pval <- t.test(hf,control)$p.value
return(pval < alpha)
}
reject (12)
reject <- function(N, alpha=0.05){
hf <- sample(hfPheno,N)
control <- sample(controlPheno,N)
pval <- t.test(hf,control)$p.value
return(pval < alpha)
}
reject (12)
rejections <- replicate(B, reject(N))
mean(rejections) # Estimated power with sample size of 12
#Improving power by increasing sample size
Ns <- seq(5, 50, 5)
power <- sapply(Ns, function(N){
rejections <- replicate(B, reject(N))
mean(rejections)
})
power
plot(Ns, power, type="b", xlab="Sample Size", ylab="Power", main="Power vs Sample Size")
abline(h=0.8, col="red", lty=2) # Desired
set.seed(1)
# function to generate one t-statistic under H0 (no diet effect)
ttestgenerator <- function(n, population){
group1 <- sample(population, n)
group2 <- sample(population, n)
tstat <- (mean(group1) - mean(group2)) /
sqrt(var(group1)/n + var(group2)/n)
return(tstat)
}
# number of Monte Carlo simulations
B <- 5000
# try two different sample sizes
n_small <- 3
n_large <- 10
# simulate t-statistics
tstats_small <- replicate(B, ttestgenerator(n_small, chowPopulation))
tstats_large <- replicate(B, ttestgenerator(n_large, chowPopulation))
# Histograms of simulated t-statistics
par(mfrow = c(1,2))
hist(tstats_small, breaks=40, probability=TRUE,
main=paste("Monte Carlo t-stats (n =", n_small, ")"),
xlab="t statistic", col="lightgray", border="white")
curve(dnorm(x, mean=0, sd=1), add=TRUE, col="red", lwd=2)        # Normal
curve(dt(x, df=2*n_small-2), add=TRUE, col="blue", lwd=2)        # t-dist
legend("topright", legend=c("Normal","t distribution"),
col=c("red","blue"), lwd=2, bty="n")
hist(tstats_large, breaks=40, probability=TRUE,
main=paste("Monte Carlo t-stats (n =", n_large, ")"),
xlab="t statistic", col="lightgray", border="white")
curve(dnorm(x, mean=0, sd=1), add=TRUE, col="red", lwd=2)
curve(dt(x, df=2*n_large-2), add=TRUE, col="blue", lwd=2)
legend("topright", legend=c("Normal","t distribution"),
col=c("red","blue"), lwd=2, bty="n")
par(mfrow=c(1,1))
#--- Premutation Test ---
set.seed(1)
# Combine treatment and control groups
combined <- c(treatment, controls)
n_treat <- length(treatment)
n_control <- length(controls)
B <- 10000
perm_diffs <- numeric(B)
for (b in 1:B) {
permuted <- sample(combined)  # Randomly permute the combined data
perm_treat <- permuted[1:n_treat]  # First n_treat elements as treatment
perm_control <- permuted[(n_treat + 1):(n_treat + n_control)]  # Remaining as control
perm_diffs[b] <- mean(perm_treat) - mean(perm_control)  # Calculate mean difference
}
# Calculate observed difference in means
obs_diff <- mean(treatment) - mean(controls)
# Calculate p-value
p_value_perm <- mean(abs(perm_diffs) >= abs(obs_diff))
p_value_perm
abline(v=obs_diff, col="red", lwd=2)
# Visualize permutation distribution
hist(perm_diffs, main="Permutation Distribution of Mean Differences", xlab="Mean Difference (Treatment - Control)", col="lightgray", border="white")
abline(v=obs_diff, col="red", lwd=2)
save.image("C:/Users/bless/Downloads/dataSciProj1/.RData")
